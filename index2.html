<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitreum Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    
    <style>
        /* --- VARIABLES Y ESTILOS GLOBALES --- */
        :root {
            --bg-color: rgba(35, 35, 45, 0.4);
            --border-color: rgba(255, 255, 255, 0.15);
            --text-color: #f0f0f0;
            --text-color-secondary: #a0a0b0;
            --accent-color: #ffc966;
            --dark-bg: #1e1e28;
            --font-family-sans: 'Nunito', sans-serif;
            --font-family-mono: 'Roboto Mono', monospace;
            --blur-amount: 22px;
            --log-success: #4ade80;
            --log-warn: #facc15;
            --log-info: #60a5fa;
            --error-color: #f87171;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scrollbar-gutter: stable; }
        body { 
            font-family: var(--font-family-sans); 
            background: #000; 
            color: var(--text-color); 
        }

        /* --- FONDOS Y LAYOUTS PRINCIPALES --- */
        #onboarding-screen, #login-screen, #setup-screen, #app-wrapper {
            background: url('/img/wall.gif') no-repeat center center/cover;
            position: relative;
            height: 100vh; 
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            transition: opacity 0.6s ease-out, visibility 0.6s, background-image 0.8s ease;
            background-attachment: fixed;
        }

        #splash-screen { position: fixed; inset: 0; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.6s ease-out; overflow: hidden; background: #000; }

        #onboarding-screen, #login-screen, #setup-screen { display: none; justify-content: center; align-items: center; opacity: 0; position: absolute; inset: 0;}
        #onboarding-screen.active, #login-screen.active, #setup-screen.active { display: flex; opacity: 1; }

        #app-wrapper { opacity: 0; visibility: hidden; }
        #app-wrapper.active { opacity: 1; visibility: visible; }

        /* --- SPLASH SCREEN --- */
        #splash-screen::before { content: ''; position: absolute; inset: -50px; filter: blur(20px); transition: filter 1s ease-out; background: url('/img/wall2.gif') no-repeat center center/cover;}
        #splash-screen.focused::before { filter: blur(0px); }
        #splash-screen.exit { opacity: 0; }
        .splash-content { text-align: center; z-index: 1; }
        .splash-logo { font-size: 4rem; font-weight: 700; letter-spacing: 0.5rem; color: rgba(255,255,255,0.8); filter: blur(4px); opacity: 0; transition: filter 1s ease-out, opacity 1s ease-out, color 1s ease-out; }
        #splash-screen.visible .splash-logo { opacity: 1; }
        #splash-screen.focused .splash-logo { filter: blur(0px); color: white; }
        .loading-text { color: var(--text-color-secondary); margin-top: 20px; opacity: 0; transition: opacity 0.5s ease-out 1s; }
        #splash-screen.visible .loading-text { opacity: 1; }
        .focus-wave { position: absolute; top: 0; left: -2%; width: 2px; height: 100%; background-color: rgba(255, 255, 255, 0.8); box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.5); transform: translateX(-50%); animation: wave-scan 2.5s ease-in-out 1s forwards; opacity: 0; }
        @keyframes wave-scan { from { left: -2%; opacity: 1; } to { left: 102%; opacity: 1; } }

        /* --- WIDGET GENERAL --- */
        .widget { background: var(--bg-color); backdrop-filter: blur(var(--blur-amount)); -webkit-backdrop-filter: blur(var(--blur-amount)); border: 1px solid var(--border-color); padding: 25px; border-radius: 25px; display: flex; flex-direction: column; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .widget:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25); }

        /* --- ONBOARDING --- */
        #onboarding-screen .onboarding-card { width: 450px; text-align: center; display: none; gap: 20px; padding: 30px; }
        #onboarding-screen .onboarding-card.active { display: flex; }
        .onboarding-image-placeholder { width: 100%; height: 180px; border-radius: 15px; background-color: rgba(0,0,0,0.2); margin-bottom: 10px; overflow: hidden; }
        .onboarding-image-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .onboarding-card h3 { font-size: 1.5rem; font-weight: 600; }
        .onboarding-card p { color: var(--text-color-secondary); line-height: 1.6; }
        .disclaimer-text { font-size: 0.9rem; }
        .onboarding-actions { margin-top: 20px; display: flex; gap: 15px; width: 100%; justify-content: center; }
        .onboarding-btn { border: none; padding: 12px 30px; border-radius: 50px; font-family: var(--font-family-sans); font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; width: 100%; }
        .onboarding-btn.primary { background-color: var(--accent-color); color: #111; }
        .onboarding-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255, 201, 102, 0.2); }
        .onboarding-btn.secondary { background-color: rgba(255, 255, 255, 0.1); color: var(--text-color); }
        .onboarding-btn.secondary:hover { background-color: rgba(255, 255, 255, 0.2); }

        /* --- LOGIN & MODAL DE ERROR --- */
        #login-screen { overflow: hidden; }
        .login-art-container { position: absolute; inset: 0; z-index: 0; }
        .login-art-shape { position: absolute; border-radius: 50%; filter: blur(150px); }
        .login-art-shape.shape1 { width: 400px; height: 400px; background: rgba(100, 100, 255, 0.3); top: 10%; left: 15%; animation: move-shape1 20s infinite alternate ease-in-out; }
        .login-art-shape.shape2 { width: 350px; height: 350px; background: rgba(255, 100, 150, 0.3); bottom: 10%; right: 15%; animation: move-shape2 25s infinite alternate ease-in-out; }
        @keyframes move-shape1 { to { transform: translate(100px, 50px) scale(1.2); } }
        @keyframes move-shape2 { to { transform: translate(-80px, -60px) scale(0.9); } }
        .login-container { width: 420px; padding: 40px; text-align: center; z-index: 1; }
        .login-logo { font-size: 2.5rem; font-weight: 700; letter-spacing: 0.3rem; margin-bottom: 10px; }
        .login-container h2 { font-weight: 500; color: var(--text-color); margin-bottom: 10px; }
        .login-container p { color: var(--text-color-secondary); margin-bottom: 30px; }
        .google-login-btn { display: inline-flex; align-items: center; justify-content: center; gap: 15px; padding: 12px 30px; border: none; border-radius: 50px; background-color: #fff; color: #333; font-family: var(--font-family-sans); font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .google-login-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .google-login-btn svg { width: 22px; height: 22px; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background: var(--dark-bg); color: var(--text-color); padding: 30px; border-radius: 20px; text-align: center; width: 90%; max-width: 400px; border: 1px solid var(--border-color); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .modal-content h3 { margin-bottom: 15px; font-size: 1.5rem; }
        .modal-content p { color: var(--text-color-secondary); margin-bottom: 25px; line-height: 1.6; }
        .modal-btn { border: none; padding: 12px 30px; border-radius: 50px; font-family: var(--font-family-sans); font-weight: 600; font-size: 1rem; cursor: pointer; transition: background-color 0.2s ease; }
        .modal-btn.primary { background-color: var(--accent-color); color: #111; width: 100%; }
        .modal-btn.secondary { background-color: rgba(255, 255, 255, 0.1); color: var(--text-color); width: 100%; }
        .modal-btn.secondary:hover { background-color: rgba(255, 255, 255, 0.2); }
        .modal-actions { display: flex; gap: 15px; margin-top: 25px; }
        .modal-icon-wrapper { width: 60px; height: 60px; background-color: rgba(255, 255, 255, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; color: var(--accent-color); }
        .modal-icon-wrapper i { width: 30px; height: 30px; }

        /* --- SETUP SCREEN --- */
        .setup-container { width: 480px; text-align: center; gap: 20px; }
        .setup-container h3 { font-size: 1.8rem; }
        .setup-container p { color: var(--text-color-secondary); margin-top: -15px; }
        .profile-editor { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; margin-top: 10px; }
        .profile-pic-label { position: relative; cursor: pointer; }
        .profile-pic-label img { width: 120px; height: 120px; border-radius: 50%; border: 3px solid var(--border-color); object-fit: cover; }
        .profile-pic-label .pic-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; opacity: 0; transition: opacity 0.3s ease; }
        .profile-pic-label:hover .pic-overlay { opacity: 1; }
        #profile-pic-input { display: none; }
        .setup-input { width: 100%; padding: 12px 20px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-color); font-size: 1rem; text-align: center; }
        .early-access-card { display: flex; align-items: center; gap: 20px; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; text-align: left; }
        .early-access-card .icon-wrapper { color: var(--accent-color); }
        .early-access-card h4 { margin: 0; font-size: 1rem; }
        .early-access-card p { margin: 0; font-size: 0.9rem; }

        /* --- LAYOUT PRINCIPAL DE LA APP --- */
        .top-nav { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 100; }
        .nav-glass-container { background: var(--bg-color); backdrop-filter: blur(var(--blur-amount)); border: 1px solid var(--border-color); border-radius: 50px; padding: 5px; }
        .top-nav ul { list-style: none; display: flex; gap: 5px; }
        .top-nav .nav-link { display: flex; align-items: center; gap: 8px; padding: 10px 25px; text-decoration: none; color: var(--text-color-secondary); font-weight: 500; border-radius: 50px; transition: all 0.3s ease; }
        .top-nav .nav-link i { width: 18px; }
        .top-nav .nav-link.active { color: #111; background: var(--text-color); font-weight: 600; }
        
        .main-container { 
            position: relative; 
            width: 100%; 
            height: 100%;
            max-width: 1600px; 
            max-height: 900px; 
            margin: 0 auto; 
        }
        
        .page-content { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; padding: 90px 50px 20px 50px; overflow-y: auto; }
        .page-content.active { display: block; }
        
        .content-holder {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 30px;
            padding: 25px;
            min-height: 100%;
        }
        .page-title { font-size: 2rem; font-weight: 700; margin-bottom: 25px; }

        /* --- GRIDS Y WIDGETS --- */
        .dashboard-grid { display: grid; grid-template-columns: 320px 1fr 400px; grid-template-rows: auto 1fr; gap: 25px; }
        .apps-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .profile-card { grid-column: 3 / 4; grid-row: 1 / 3; }
        .clock-widget { grid-column: 1 / 2; grid-row: 1 / 2; }
        .charging-stats { grid-column: 1 / 2; grid-row: 2 / 3; }
        .updates-widget { grid-column: 2 / 3; grid-row: 1 / 2; background: rgba(10, 10, 15, 0.4); }
        .mindfulness-stats { grid-column: 2 / 3; grid-row: 2 / 3; }
        .clock-widget { justify-content: center; align-items: center; text-align: center; }
        #clock-time { font-size: 5rem; font-weight: 700; line-height: 1; }
        #clock-date { font-size: 1.2rem; color: var(--text-color-secondary); }
        
        .updates-widget pre {
            font-family: var(--font-family-mono);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-top: 15px;
            overflow: auto;
            flex-grow: 1;
            min-height: 0;
        }

        .updates-widget code .log-success { color: var(--log-success); }
        .updates-widget code .log-warn { color: var(--log-warn); }
        .updates-widget code .log-info { color: var(--log-info); }
        
        .mindfulness-stats { 
            align-items: center; 
            text-align: center; 
            justify-content: space-between; 
        }
        .stat-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            border: 1px solid var(--border-color);
            padding: 15px 10px; 
            border-radius: 20px; 
            flex-grow: 1; 
        }

        .profile-card { justify-content: space-between; align-items: center; text-align: center; }
        .profile-main { margin-top: 20px; display: flex; flex-direction: column; align-items: center; }
        .profile-info-list { list-style: none; width: 100%; padding: 0 20px; margin: 20px 0; }
        .profile-info-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .profile-info-list li:last-child { border-bottom: none; }
        .profile-info-list li span { color: var(--text-color-secondary); }
        .profile-nav { margin-bottom: 20px; }
        .app-card { gap: 20px; }
        .app-preview-image { width: 100%; height: 160px; border-radius: 15px; overflow: hidden; background-color: rgba(0,0,0,0.2); }
        .app-preview-image img { width: 100%; height: 100%; object-fit: cover; }
        .app-info h3 { font-size: 1.2rem; }
        .app-info p { font-size: 0.9rem; color: var(--text-color-secondary); }
        .app-open-button { background-color: var(--accent-color); color: #111; text-decoration: none; text-align: center; padding: 12px; border-radius: 12px; font-weight: 600; margin-top: auto; transition: transform 0.2s ease; display: block; cursor: pointer; }
        .app-open-button:hover { transform: translateY(-2px); }
        .charging-stats .subtitle { color: var(--text-color-secondary); font-size: 0.9rem; margin-top: 5px; }
        .progress-circle { position: relative; width: 100px; height: 100px; display: flex; justify-content: center; align-items: center; margin: auto; }
        .progress-circle svg { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
        .progress-circle .progress-bg { fill: none; stroke: rgba(255, 255, 255, 0.1); stroke-width: 10; }
        .progress-circle .progress-bar { fill: none; stroke: var(--accent-color); stroke-width: 10; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 0.8s ease; }
        .progress-text { font-size: 1.5rem; font-weight: 600; }
        .charge-toggle { display: flex; align-items: center; justify-content: space-between; background: rgba(0, 0, 0, 0.2); border-radius: 50px; padding: 5px; margin-top: auto; }
        .charge-toggle .icon-wrapper { background: var(--accent-color); color: #333; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .charge-toggle span { margin-right: 20px; font-weight: 500; }
        .stats-grid { display: flex; justify-content: space-around; width: 100%; gap: 10px; }
        .stat-item .label { font-size: 0.8rem; color: var(--text-color-secondary); }
        .stat-item .value { font-size: 1.2rem; font-weight: 600; margin-top: 5px; }
        .profile-picture { width: 120px; height: 120px; border-radius: 50%; margin-bottom: 15px; position: relative; }
        .profile-picture::before { content: ''; position: absolute; inset: -8px; border-radius: 50%; background: radial-gradient(circle, var(--accent-color) 40%, transparent 70%); filter: blur(15px); z-index: -1; animation: subtle-pulse 5s infinite ease-in-out; }
        @keyframes subtle-pulse { 0%, 100% { transform: scale(1); opacity: 0.7; } 50% { transform: scale(1.05); opacity: 1; } }
        .profile-picture img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid white; }
        .profile-main h2 { font-size: 1.8rem; font-weight: 500; }
        .profile-nav { display: flex; gap: 15px; background: rgba(0, 0, 0, 0.2); padding: 10px 20px; border-radius: 30px; }
        .nav-icon { background: transparent; border: none; color: var(--text-color-secondary); padding: 10px; border-radius: 50%; cursor: pointer; transition: color 0.2s, background-color 0.2s; display: flex; }
        .nav-icon:hover { color: var(--text-color); background-color: rgba(255,255,255,0.1); }

        /* --- SECCIÓN DE SERVICIOS (NUEVOS ESTILOS) --- */
        .services-category {
            margin-bottom: 40px;
        }
        .services-category:last-child {
            margin-bottom: 0;
        }
        .category-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        /* --- SECCIÓN DE AJUSTES --- */
        .settings-section { display: flex; flex-direction: column; gap: 25px; }
        .settings-card { background: var(--bg-color); backdrop-filter: blur(var(--blur-amount)); -webkit-backdrop-filter: blur(var(--blur-amount)); border: 1px solid var(--border-color); padding: 25px; border-radius: 25px; }
        .settings-card h3 { margin-bottom: 20px; font-weight: 600; }
        .file-upload-btn { display: flex; align-items: center; justify-content: center; width: 100%; text-align: center; border: none; padding: 12px 20px; border-radius: 10px; font-family: var(--font-family-sans); font-weight: 600; cursor: pointer; transition: all 0.3s ease; background-color: var(--accent-color); color: #111; }
        .file-upload-btn i { margin-right: 8px; }
        #background-file-input { display: none; }
        #mobile-profile-card { display: none; }

        /* --- DISEÑO RESPONSIVO --- */
        @media (max-width: 1200px) { .dashboard-grid { grid-template-columns: 1fr 1fr; grid-template-rows: auto; } .profile-card { grid-column: 2 / 3; grid-row: 1 / 3; } }
        
        @media (max-width: 800px) { 
            .top-nav { 
                position: fixed;
                top: auto; 
                bottom: 20px; 
                width: auto; 
                transform: translateX(-50%); 
            } 
            .nav-glass-container { border-radius: 50px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); } 
            .top-nav .nav-link { padding: 12px; }
            .top-nav .nav-link span { display: none; }
            .top-nav .nav-link.active { background: var(--accent-color); color: #111; }
            .top-nav .nav-link.active i { color: #111; }
            
            .main-container { 
                padding: 0;
                max-height: none;
            } 
            .page-content { 
                padding: 20px 20px 120px 20px;
            } 
            .dashboard-grid { display: flex; flex-direction: column; gap: 20px; }
            
            .dashboard-grid .profile-card { display: none; }
            #mobile-profile-card { display: flex; }
        }
        
        @media (max-width: 500px) { 
            #onboarding-screen .onboarding-card, .login-container, .setup-container { width: 90%; padding: 20px; } 
            .onboarding-actions { flex-direction: column; } 
        }
    </style>
</head>
<body>

    <!-- MODAL DE ERROR DE LOGIN -->
    <div id="login-error-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Acceso Restringido</h3>
            <p id="login-error-modal-message">Debes usar una cuenta de correo institucional (@ucuenca.edu.ec) para poder acceder.</p>
            <button id="login-error-modal-close" class="modal-btn primary" style="width:100%;">Entendido</button>
        </div>
    </div>

    <!-- MODAL DE REDIRECCIÓN A ENOVA -->
    <div id="enova-redirect-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon-wrapper">
                <i data-lucide="external-link"></i>
            </div>
            <h3>Redirección Segura</h3>
            <p>Estás a punto de ser dirigido al portal oficial de Enova (Moodle) para iniciar sesión. Vitreum Hub no gestiona tus credenciales.</p>
            <div class="modal-actions">
                <button id="enova-redirect-cancel" class="modal-btn secondary">Cancelar</button>
                <button id="enova-redirect-confirm" class="modal-btn primary">Continuar</button>
            </div>
        </div>
    </div>

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="splash-content">
            <h1 class="splash-logo">VITREUM</h1>
            <p class="loading-text"></p>
        </div>
        <div class="focus-wave"></div>
    </div>

    <!-- ONBOARDING SCREEN -->
    <div id="onboarding-screen">
        <div id="welcome-card" class="onboarding-card widget active">
            <div class="onboarding-image-placeholder">
                 <img src="/img/inicio2.gif" alt="Imagen de Bienvenida">
            </div>
            <h3>Bienvenido a Vitreum Hub</h3>
            <p>Nuestro objetivo es simplificar y unificar el acceso a los servicios digitales de la Universidad de Cuenca para todos los estudiantes.</p>
            <div class="onboarding-actions">
                <button id="next-btn" class="onboarding-btn primary">Siguiente</button>
            </div>
        </div>
        <div id="agreement-card" class="onboarding-card widget">
            <div class="onboarding-image-placeholder">
                 <img src="/img/terminos.gif" alt="Imagen de Acuerdo">
            </div>
            <h3>Acuerdo de Usuario</h3>
            <p class="disclaimer-text">
                Esta aplicación es un proyecto independiente y <strong>no es una plataforma oficial</strong> de la Universidad de Cuenca. Las marcas y logos utilizados son propiedad de la universidad. Al continuar, aceptas usar esta herramienta bajo tu propia responsabilidad.
            </p>
            <div class="onboarding-actions">
                <button id="deny-btn" class="onboarding-btn secondary">Denegar</button>
                <button id="accept-btn" class="onboarding-btn primary">Aceptar y Continuar</button>
            </div>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-art-container">
            <div class="login-art-shape shape1"></div>
            <div class="login-art-shape shape2"></div>
        </div>
        <div class="login-container widget">
            <h1 class="login-logo">VITREUM</h1>
            <h2>Acceso Estudiantil</h2>
            <p>Usa tu cuenta institucional para ingresar al ecosistema.</p>
            <button id="google-login-btn" class="google-login-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.9 8.2,4.73 12.19,4.73C14.03,4.73 15.6,5.36 16.81,6.45L18.87,4.59C17.01,3.01 14.7,2 12.19,2C6.42,2 2.03,6.8 2.03,12C2.03,17.05 6.16,22 12.19,22C17.6,22 21.54,18.33 21.54,12.29C21.54,11.77 21.48,11.44 21.35,11.1Z"/></svg>
                <span>Seleccionar cuenta de Google</span>
            </button>
        </div>
    </div>

    <!-- SETUP SCREEN -->
    <div id="setup-screen">
        <div class="setup-container widget">
            <h3>Configuración Inicial</h3>
            <p>Personaliza tu perfil antes de continuar.</p>
            
            <div class="profile-editor">
                <label for="profile-pic-input" class="profile-pic-label">
                    <img id="setup-profile-pic" src="https://placehold.co/120x120/1e1e28/f0f0f0?text=?" alt="Foto de perfil">
                    <div class="pic-overlay"><i data-lucide="camera"></i></div>
                </label>
                <input type="file" id="profile-pic-input" accept="image/*">
                <input type="text" id="setup-display-name" class="setup-input" placeholder="Tu nombre para mostrar">
            </div>

            <div class="early-access-card">
                <div class="icon-wrapper"><i data-lucide="shield-alert"></i></div>
                <div class="text-wrapper">
                    <h4>Acceso Anticipado</h4>
                    <p>Esta versión es gratuita. Futuras versiones podrían tener funciones premium.</p>
                </div>
            </div>

            <button id="finish-setup-btn" class="onboarding-btn primary">Finalizar y Entrar</button>
        </div>
    </div>

    <!-- APP WRAPPER -->
    <div id="app-wrapper">
        <nav class="top-nav">
            <div class="nav-glass-container">
                <ul>
                    <li><a href="#" class="nav-link active" data-target="summary-content"><i data-lucide="layout-grid"></i><span>Resumen</span></a></li>
                    <li><a href="#" class="nav-link" data-target="services-content"><i data-lucide="briefcase"></i><span>Servicios</span></a></li>
                    <li><a href="#" class="nav-link" data-target="apps-content"><i data-lucide="app-window"></i><span>Apps</span></a></li>
                    <li><a href="#" class="nav-link" data-target="settings-content"><i data-lucide="settings"></i><span>Ajustes</span></a></li>
                </ul>
            </div>
        </nav>
        <main class="main-container">
            <div id="summary-content" class="page-content active">
                <div class="content-holder">
                    <h1 class="page-title">Resumen</h1>
                    <div class="dashboard-grid">
                        <div class="widget clock-widget"><div id="clock-time">17:01</div><div id="clock-date">Tuesday, 24 Oct</div></div>
                        <div class="widget updates-widget">
                            <h3>Últimas Actualizaciones</h3>
                            <pre><code id="updates-log">Cargando actualizaciones...</code></pre>
                        </div>
                        <div class="widget mindfulness-stats">
                            <h3>Acceso Ucuenca</h3>
                            <p class="subtitle">Inicio Ultra Rápido</p>
                            <br>
                            <div class="stats-grid">
                                <div class="stat-item"><span class="label">E-learning</span><span class="value">Moodle</span></div>
                            </div>
                            <div id="enova-login-btn" class="app-open-button" style="width: 100%; margin-top: 15px;">
                                Iniciar Sesión
                            </div>
                        </div>
                        <div class="widget charging-stats">
                            <h3>Estado del sistema</h3><p class="subtitle">Estado de los servicios Ucuenca</p>
                            <br>
                            <div class="progress-circle" data-progress="100"><svg viewBox="0 0 100 100"><circle class="progress-bg" cx="50" cy="50" r="45"></circle><circle class="progress-bar" cx="50" cy="50" r="45"></circle></svg><span class="progress-text">100%</span></div>
                            <br>
                            <div class="charge-toggle"><div class="icon-wrapper"><i data-lucide="zap"></i></div><span>Optimo 👌</span></div>
                        </div>
                        <div class="widget profile-card">
                            <div class="profile-main">
                                <div class="profile-picture">
                                    <img class="user-profile-pic" src="https://placehold.co/120x120/ffffff/1e1e28?text=U" alt="User's profile picture">
                                </div>
                                <h2 class="user-display-name">Usuario</h2>
                            </div>
                            <ul class="profile-info-list">
                                <li><span>Email</span><strong class="user-email">correo@ejemplo.com</strong></li>
                                <li><span>U. Educativa</span><strong>U. de Cuenca</strong></li>
                                <li><span>Membresía</span><strong class="user-license log-success">Acceso Anticipado</strong></li>
                            </ul>
                            <div class="profile-nav">
                                <button id="logout-btn" class="nav-icon" title="Cerrar Sesión"><i data-lucide="log-out"></i></button>
                                <button class="nav-icon" title="Modo Foco"><i data-lucide="monitor-smartphone"></i></button>
                                <a href="https://gemini.google.com/" target="_blank" class="nav-icon" title="Abrir Google Gemini"><i data-lucide="sparkles"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="apps-content" class="page-content">
                <div class="content-holder">
                    <h1 class="page-title">Ecosistema Vitreum</h1>
                    <div class="apps-grid">
                        <div class="widget app-card">
                            <div class="app-preview-image"><img src="https://placehold.co/400x200/333/fff?text=Studi.App" alt="Studi.App Builder"></div>
                            <div class="app-info"><h3>Studi.App Builder</h3><p>Crea y personaliza recursos educativos interactivos.</p></div>
                            <a href="#" target="_blank" class="app-open-button">Abrir Builder</a>
                        </div>
                        <div class="widget app-card">
                            <div class="app-preview-image"><img src="https://placehold.co/400x200/444/fff?text=QuantumNotes" alt="QuantumNotes"></div>
                            <div class="app-info"><h3>QuantumNotes</h3><p>Toma de apuntes inteligente con IA integrada.</p></div>
                            <a href="#" target="_blank" class="app-open-button">Abrir Notas</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- SECCIÓN DE SERVICIOS - MODIFICADA -->
            <div id="services-content" class="page-content">
                <div class="content-holder">
                    <h1 class="page-title">Servicios Universitarios</h1>
                    
                    <!-- Categoría: Servicios Internos -->
                    <div class="services-category">
                        <h2 class="category-title">Servicios Internos</h2>
                        <div class="apps-grid">
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="
https://www.ucuenca.edu.ec/wp-content/uploads/2025/03/Banner_Experience_2.gif" alt="Nova SGA"></div>
                                <div class="app-info"><h3>Nova (SGA)</h3><p>Consulta tus notas, materias y recursos académicos.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Ir a Nova</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT0Hu2uFyAz4ubdDuohtQ3MoKFBm5ZxOcM1iA&s" alt="Enova Moodle"></div>
                                <div class="app-info"><h3>eNOVA (Moodle)</h3><p>Plataforma de e-learning para tus cursos.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Ir a eNOVA</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://platform.theverge.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/21939811/newgmaillogo.jpg?quality=90&strip=all&crop=0,0,100,100" alt="Correo Institucional"></div>
                                <div class="app-info"><h3>Correo Institucional</h3><p>Acceso directo a tu bandeja de entrada de Gmail.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Abrir Correo</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSXEk26yJKOSf2w4CziuP2VOdfeCdlBC5jesg&s" alt="Correo Institucional"></div>
                                <div class="app-info"><h3>Portal de servicios</h3><p>Acceso a silabos e informacion general</p></div>
                                <a href="#" target="_blank" class="app-open-button">Abrir Portal</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://www.ucuenca.edu.ec/wp-content/uploads/2025/01/DSC07459.jpg" alt="Correo Institucional"></div>
                                <div class="app-info"><h3>Biblioteca Digital</h3><p>Acceso directo biblioteca</p></div>
                                <a href="#" target="_blank" class="app-open-button">Abrir Pagina web</a>
                            </div>
                        </div>
                    </div>

                    <!-- Categoría: Documentos Generales -->
                    <div class="services-category">
                        <h2 class="category-title">Documentos Generales</h2>
                        <div class="apps-grid">
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/009688/fff?text=Reglamento" alt="Reglamento Estudiantil"></div>
                                <div class="app-info"><h3>Reglamento Estudiantil</h3><p>Consulta las normativas y derechos estudiantiles.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Ver Documento</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/FF9800/fff?text=Calendario" alt="Calendario Académico"></div>
                                <div class="app-info"><h3>Calendario Académico</h3><p>Fechas importantes, periodos de matrícula y exámenes.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Ver Calendario</a>
                            </div>
                             <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/795548/fff?text=Biblioteca" alt="Biblioteca"></div>
                                <div class="app-info"><h3>Biblioteca Virtual</h3><p>Busca y accede a la base de datos de la biblioteca.</p></div>
                                <a href="#" target="_blank" class="app-open-button">Buscar Libros</a>
                            </div>
                        </div>
                    </div>

                    <!-- Categoría: Redes Sociales -->
                     <div class="services-category">
                        <h2 class="category-title">Redes Sociales</h2>
                        <div class="apps-grid">
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/3b5998/fff?text=Facebook" alt="Facebook"></div>
                                <div class="app-info"><h3>Facebook</h3><p>Mantente al día con las noticias y eventos oficiales.</p></div>
                                <a href="https://www.facebook.com/ucuenca" target="_blank" class="app-open-button">Seguir en Facebook</a>
                            </div>
                            <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/e4405f/fff?text=Instagram" alt="Instagram"></div>
                                <div class="app-info"><h3>Instagram</h3><p>Descubre el día a día de la comunidad universitaria.</p></div>
                                <a href="https://www.instagram.com/udecuenca/#" target="_blank" class="app-open-button">Seguir en Instagram</a>
                            </div>
                             <div class="widget app-card">
                                <div class="app-preview-image"><img src="https://placehold.co/400x200/000000/fff?text=X" alt="X (Twitter)"></div>
                                <div class="app-info"><h3>X (Twitter)</h3><p>Comunicados y actualizaciones importantes al instante.</p></div>
                                <a href="https://twitter.com/udecuenca" target="_blank" class="app-open-button">Seguir en X</a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div id="settings-content" class="page-content">
                <div class="content-holder">
                    <h1 class="page-title">Ajustes</h1>
                    <div class="settings-section">
                        <div id="mobile-profile-card" class="widget profile-card">
                             <div class="profile-main">
                                <div class="profile-picture">
                                    <img class="user-profile-pic" src="https://placehold.co/120x120/ffffff/1e1e28?text=U" alt="User's profile picture">
                                </div>
                                <h2 class="user-display-name">Usuario</h2>
                            </div>
                            <ul class="profile-info-list">
                                <li><span>Email</span><strong class="user-email">correo@ejemplo.com</strong></li>
                                <li><span>U. Educativa</span><strong>U. de Cuenca</strong></li>
                                <li><span>Membresía</span><strong class="user-license log-success">Acceso Anticipado</strong></li>
                            </ul>
                            <div class="profile-nav">
                                <button class="nav-icon logout-btn-mobile" title="Cerrar Sesión"><i data-lucide="log-out"></i></button>
                                <button class="nav-icon" title="Modo Foco"><i data-lucide="monitor-smartphone"></i></button>
                                <a href="https://gemini.google.com/" target="_blank" class="nav-icon" title="Abrir Google Gemini"><i data-lucide="sparkles"></i></a>
                            </div>
                        </div>
                        
                        <div class="settings-card">
                            <h3>Personalizar Fondo</h3>
                            <p style="color: var(--text-color-secondary); margin-bottom: 15px;">Elige una imagen de tu dispositivo para usarla como fondo.</p>
                            <label for="background-file-input" class="file-upload-btn">
                                <i data-lucide="image"></i>
                                Seleccionar Imagen
                            </label>
                            <input type="file" id="background-file-input" accept="image/*">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Lógica de la Aplicación -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- CONFIGURACIÓN DE FIREBASE ---
            const firebaseConfig = {
                apiKey: "AIzaSyB1W2yLlVHivzBQPZJVOgpApQeYnJUFzCs",
                authDomain: "vitreumucuencahub.firebaseapp.com",
                projectId: "vitreumucuencahub",
                storageBucket: "vitreumucuencahub.firebasestorage.app",
                messagingSenderId: "628136581064",
                appId: "1:628136581064:web:9ba793a7dfc104602fd2fd"
            };

            // --- INICIALIZACIÓN DE FIREBASE ---
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const provider = new firebase.auth.GoogleAuthProvider();

            // --- SELECTORES DE ELEMENTOS DEL DOM ---
            const splashScreen = document.getElementById('splash-screen');
            const onboardingScreen = document.getElementById('onboarding-screen');
            const loginScreen = document.getElementById('login-screen');
            const setupScreen = document.getElementById('setup-screen');
            const appWrapper = document.getElementById('app-wrapper');
            let currentUserData = {};

            // --- MÓDULO DE INICIALIZACIÓN PRINCIPAL ---
            function initializeApp() {
                lucide.createIcons();
                startClock();
                animateProgressBars();
                setupNavigation();
                setupActionButtons();
                setupBackgroundChanger();
                setupModals();
                setRealViewportHeight();
                window.addEventListener('resize', setRealViewportHeight);
                fetchUpdates();
                determineInitialFlow();
            }

            // --- MÓDULO DE ACTUALIZACIONES DESDE GITHUB ---
            async function fetchUpdates() {
                const logElement = document.getElementById('updates-log');
                if (!logElement) return;
                const url = 'https://raw.githubusercontent.com/EllieWasteland/VitreumUcuencaHUB/main/README.md';
                try {
                    const response = await fetch(url, { cache: 'no-cache' });
                    if (!response.ok) throw new Error(`Error de red! Estatus: ${response.status}`);
                    const markdown = await response.text();
                    const heading = '## Últimas Actualizaciones';
                    const startIndex = markdown.indexOf(heading);
                    if (startIndex === -1) { logElement.textContent = 'Error: No se encontró el encabezado.'; return; }
                    const codeBlockStartIndex = markdown.indexOf('```', startIndex);
                    if (codeBlockStartIndex === -1) { logElement.textContent = 'Error: No se encontró el bloque de código.'; return; }
                    const codeBlockEndIndex = markdown.indexOf('```', codeBlockStartIndex + 3);
                    if (codeBlockEndIndex === -1) { logElement.textContent = 'Error: No se encontró el final del bloque de código.'; return; }
                    const updatesContent = markdown.substring(codeBlockStartIndex + 3, codeBlockEndIndex).trim();
                    if (updatesContent) {
                        const escapedContent = updatesContent.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                        const formattedHtml = escapedContent
                            .replace(/\[OK\]/g, '[<span class="log-success">OK</span>]')
                            .replace(/\[INFO\]/g, '[<span class="log-info">INFO</span>]')
                            .replace(/\[WARN\]/g, '[<span class="log-warn">WARN</span>]');
                        logElement.innerHTML = formattedHtml;
                    } else {
                        logElement.textContent = 'La sección de actualizaciones está vacía.';
                    }
                } catch (error) {
                    console.error('Error al cargar las actualizaciones:', error);
                    logElement.textContent = '> Error de conexión al cargar actualizaciones.';
                }
            }

            function setRealViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            // --- LÓGICA DE FLUJO INICIAL ---
            function determineInitialFlow() {
                setTimeout(() => splashScreen.classList.add('visible'), 500);
                setTimeout(() => splashScreen.classList.add('focused'), 2000);
                setTimeout(() => {
                    splashScreen.classList.add('exit');
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                        auth.onAuthStateChanged(user => {
                            const onboardingComplete = localStorage.getItem('vitreumHubOnboardingComplete');
                            if (onboardingComplete !== 'true') {
                                transitionTo(onboardingScreen);
                                setupOnboarding();
                                return;
                            }
                            if (user) {
                                if (!user.email.endsWith('@ucuenca.edu.ec')) {
                                    auth.signOut();
                                    document.getElementById('login-error-modal')?.classList.add('show');
                                    transitionTo(loginScreen);
                                    setupLogin();
                                    return;
                                }
                                const setupComplete = localStorage.getItem(`vitreumHubSetupComplete_${user.uid}`);
                                if (setupComplete === 'true') {
                                    loadUserFromStorage(user);
                                    updateUIForUser(currentUserData);
                                    transitionTo(appWrapper);
                                } else {
                                    currentUserData = { displayName: user.displayName, photoURL: user.photoURL, email: user.email, uid: user.uid };
                                    transitionTo(setupScreen);
                                    setupInitialConfig();
                                }
                            } else {
                                transitionTo(loginScreen);
                                setupLogin();
                            }
                        });
                    }, 600);
                }, 3000);
            }

            // --- MANEJO DE TRANSICIONES Y MODALES ---
            function transitionTo(activeScreen) {
                [onboardingScreen, loginScreen, setupScreen, appWrapper].forEach(screen => {
                    screen.classList.remove('active');
                });
                if (activeScreen) activeScreen.classList.add('active');
            }
            
            function setupModals() {
                const loginErrorModal = document.getElementById('login-error-modal');
                const closeLoginErrorBtn = document.getElementById('login-error-modal-close');
                const enovaRedirectModal = document.getElementById('enova-redirect-modal');
                const enovaRedirectConfirm = document.getElementById('enova-redirect-confirm');
                const enovaRedirectCancel = document.getElementById('enova-redirect-cancel');
                const enovaLoginBtn = document.getElementById('enova-login-btn');

                closeLoginErrorBtn?.addEventListener('click', () => loginErrorModal?.classList.remove('show'));
                
                enovaLoginBtn?.addEventListener('click', (e) => {
                    e.preventDefault();
                    enovaRedirectModal?.classList.add('show');
                });

                enovaRedirectConfirm?.addEventListener('click', () => {
                    window.open('https://enova-grado.ucuenca.edu.ec/login/index.php', '_blank');
                    enovaRedirectModal?.classList.remove('show');
                });

                enovaRedirectCancel?.addEventListener('click', () => enovaRedirectModal?.classList.remove('show'));
            }

            // --- MANEJO DEL ONBOARDING ---
            function setupOnboarding() {
                const nextBtn = document.getElementById('next-btn');
                const acceptBtn = document.getElementById('accept-btn');
                const denyBtn = document.getElementById('deny-btn');
                nextBtn.addEventListener('click', () => {
                    document.getElementById('welcome-card').classList.remove('active');
                    document.getElementById('agreement-card').classList.add('active');
                });
                acceptBtn.addEventListener('click', () => {
                    localStorage.setItem('vitreumHubOnboardingComplete', 'true');
                    transitionTo(loginScreen);
                    setupLogin();
                });
                denyBtn.addEventListener('click', () => {
                    // Replace alert with a custom modal in the future
                    const modal = document.createElement('div');
                    modal.innerHTML = `<div class="modal-overlay show"><div class="modal-content"><h3>Acuerdo Requerido</h3><p>Debes aceptar los términos para poder usar la aplicación.</p><button class="modal-btn primary">Entendido</button></div></div>`;
                    document.body.appendChild(modal);
                    modal.querySelector('button').onclick = () => modal.remove();
                });
            }

            // --- MÓDULO DE LOGIN CON GOOGLE ---
            function setupLogin() {
                const googleLoginBtn = document.getElementById('google-login-btn');
                const newBtn = googleLoginBtn.cloneNode(true);
                googleLoginBtn.parentNode.replaceChild(newBtn, googleLoginBtn);
                newBtn.addEventListener('click', () => {
                    auth.signInWithPopup(provider).catch(error => {
                        console.error("Error de login:", error);
                        document.getElementById('login-error-modal')?.classList.add('show');
                    });
                });
            }

            // --- MANEJO DE CONFIGURACIÓN INICIAL ---
            function setupInitialConfig() {
                const setupProfilePic = document.getElementById('setup-profile-pic');
                const setupDisplayName = document.getElementById('setup-display-name');
                const profilePicInput = document.getElementById('profile-pic-input');
                const finishSetupBtn = document.getElementById('finish-setup-btn');

                setupProfilePic.src = currentUserData.photoURL || 'https://placehold.co/120x120/1e1e28/f0f0f0?text=?';
                setupDisplayName.value = currentUserData.displayName;

                profilePicInput.onchange = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => { setupProfilePic.src = e.target.result; };
                        reader.readAsDataURL(file);
                    }
                };

                finishSetupBtn.onclick = () => {
                    const user = auth.currentUser;
                    if (user) {
                        currentUserData.displayName = setupDisplayName.value;
                        currentUserData.photoURL = setupProfilePic.src;
                        localStorage.setItem(`vitreumHubSetupComplete_${user.uid}`, 'true');
                        localStorage.setItem(`vitreumHubDisplayName_${user.uid}`, currentUserData.displayName);
                        if (currentUserData.photoURL.startsWith('data:image')) {
                            localStorage.setItem(`vitreumHubPhotoURL_${user.uid}`, currentUserData.photoURL);
                        }
                        updateUIForUser(currentUserData);
                        transitionTo(appWrapper);
                    }
                };
            }
            
            // --- MANEJO DE DATOS DE USUARIO ---
            function loadUserFromStorage(user) {
                 currentUserData = {
                    displayName: localStorage.getItem(`vitreumHubDisplayName_${user.uid}`) || user.displayName,
                    photoURL: localStorage.getItem(`vitreumHubPhotoURL_${user.uid}`) || user.photoURL,
                    email: user.email,
                    uid: user.uid
                };
            }

            function updateUIForUser(userData) {
                if (!userData) return;
                document.querySelectorAll('.user-profile-pic').forEach(el => el.src = userData.photoURL);
                document.querySelectorAll('.user-display-name').forEach(el => el.textContent = userData.displayName);
                document.querySelectorAll('.user-email').forEach(el => el.textContent = userData.email);
            }

            // --- ACCIONES (NAVEGACIÓN Y LOGOUT) ---
            function setupNavigation() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('data-target');
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
                        link.classList.add('active');
                        const targetPage = document.getElementById(targetId);
                        if(targetPage) {
                            targetPage.classList.add('active');
                            targetPage.scrollTo(0, 0);
                        }
                    });
                });
            }
            
            function handleLogout() {
                auth.signOut().then(() => {
                    document.body.style.opacity = '0';
                    setTimeout(() => location.reload(), 500);
                });
            }

            function setupActionButtons() {
                document.getElementById('logout-btn')?.addEventListener('click', handleLogout);
                document.querySelector('.logout-btn-mobile')?.addEventListener('click', handleLogout);
            }

            // --- FUNCIONES DE UI ADICIONALES ---
            function loadCustomBackground() {
                const customBg = localStorage.getItem('vitreumHubCustomBackground');
                if (customBg) appWrapper.style.backgroundImage = `url('${customBg}')`;
            }

            function setupBackgroundChanger() {
                const bgFileInput = document.getElementById('background-file-input');
                bgFileInput?.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const newBgDataUrl = event.target.result;
                            appWrapper.style.backgroundImage = `url('${newBgDataUrl}')`;
                            localStorage.setItem('vitreumHubCustomBackground', newBgDataUrl);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // --- MÓDULOS DE UI (RELOJ, BARRAS DE PROGRESO) ---
            function startClock() {
                const timeEl = document.getElementById('clock-time');
                const dateEl = document.getElementById('clock-date');
                if (!timeEl || !dateEl) return;
                function updateClock() {
                    const now = new Date();
                    timeEl.textContent = now.toLocaleTimeString('es-EC', { hour: '2-digit', minute: '2-digit', hour12: false });
                    dateEl.textContent = now.toLocaleDateString('es-EC', { weekday: 'long', day: 'numeric', month: 'short' });
                }
                updateClock();
                setInterval(updateClock, 1000);
            }
            
            function animateProgressBars() {
                document.querySelectorAll('.progress-circle').forEach(circle => {
                    const bar = circle.querySelector('.progress-bar');
                    const progress = circle.dataset.progress;
                    if (bar && progress) {
                        const r = bar.r.baseVal.value;
                        const circumference = 2 * Math.PI * r;
                        bar.style.strokeDashoffset = circumference * (1 - progress / 100);
                    }
                });
            }

            // --- INICIAR LA APLICACIÓN ---
            initializeApp();
        });
    </script>
</body>
</html>
